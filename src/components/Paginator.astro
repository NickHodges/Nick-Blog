---
import type { Page } from 'astro';

interface Props {
  page: Page<any>;
}

const { page } = Astro.props;

// Generate page numbers to display
function getPageNumbers(currentPage: number, lastPage: number) {
  const delta = 2; // Number of pages to show on each side of current page
  const range = [];
  const rangeWithDots = [];
  let l;

  for (let i = 1; i <= lastPage; i++) {
    if (i === 1 || i === lastPage || (i >= currentPage - delta && i <= currentPage + delta)) {
      range.push(i);
    }
  }

  for (let i of range) {
    if (l) {
      if (i - l === 2) {
        rangeWithDots.push(l + 1);
      } else if (i - l !== 1) {
        rangeWithDots.push('...');
      }
    }
    rangeWithDots.push(i);
    l = i;
  }

  return rangeWithDots;
}

const pageNumbers = getPageNumbers(page.currentPage, page.lastPage);

// Generate URL for a given page number
function getPageUrl(pageNum: number) {
  if (pageNum === 1) {
    return page.url.current.replace(/\/\d+\/?$/, '/');
  }
  return page.url.current.replace(/\/?\d*\/?$/, `/${pageNum}/`);
}
---

{
  page.lastPage > 1 && (
    <nav class='mt-8 flex items-center justify-center gap-2' aria-label='Pagination'>
      {page.url.prev && (
        <a class='rounded px-3 py-2 sm:hover:text-accent' data-astro-prefetch href={page.url.prev} aria-label='Previous page'>
          ← Previous
        </a>
      )}
      {pageNumbers.map((num) =>
        num === '...' ? (
          <span class='px-2'>…</span>
        ) : (
          <a
            class={`rounded px-3 py-2 ${num === page.currentPage ? 'bg-accent text-bgColor font-bold' : 'sm:hover:text-accent'}`}
            data-astro-prefetch
            href={getPageUrl(num as number)}
            aria-label={`Page ${num}`}
            aria-current={num === page.currentPage ? 'page' : undefined}
          >
            {num}
          </a>
        )
      )}
      {page.url.next && (
        <a class='rounded px-3 py-2 sm:hover:text-accent' data-astro-prefetch href={page.url.next} aria-label='Next page'>
          Next →
        </a>
      )}
    </nav>
  )
}
